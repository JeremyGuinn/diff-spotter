<!-- Image picking stage -->

<div
  class="flex size-full items-center justify-center gap-8 p-2"
  *ngIf="!modifiedFile() || !originalFile()"
>
  <div class="size-full">
    <app-image-upload-input
      *ngIf="!originalFile()"
      (fileUpload)="handleFileUpload($event, true)"
      class="mb-4"
    ></app-image-upload-input>

    <app-image-upload-preview
      *ngIf="originalFile() as file"
      [file]="file"
      (remove)="handleFileRemove(true)"
    ></app-image-upload-preview>
  </div>
  <div class="size-full">
    <app-image-upload-input
      *ngIf="!modifiedFile()"
      (fileUpload)="handleFileUpload($event, false)"
      class="mb-4"
    ></app-image-upload-input>

    <app-image-upload-preview
      *ngIf="modifiedFile() as file"
      [file]="file"
      (remove)="handleFileRemove(false)"
    ></app-image-upload-preview>
  </div>
</div>

<!-- show a loading spinner while !originalImage() || !modifiedImage() -->
<div
  class="flex size-full items-center justify-center"
  *ngIf="(!originalImage() || !modifiedImage()) && originalFile() && modifiedFile()"
>
  <ng-icon name="remixLoader4Line" class="animate-spin" size="10rem"></ng-icon>
</div>

<!-- Image diff stage -->
<div class="flex size-full flex-col gap-2 p-2" *ngIf="originalImage() && modifiedImage()">
  <div class="flex justify-between">
    <div class="flex flex-1 gap-2">
      <button class="btn btn-ghost btn-sm flex-1 justify-start" (click)="openFile('original')">
        <ng-icon name="remixImageFill"></ng-icon>
        <span>{{ originalFile()?.name }}</span>
      </button>
      <button class="btn btn-ghost btn-primary btn-sm" (click)="openFile('original')">
        <ng-icon name="remixFileAddLine"></ng-icon>
        Open file
      </button>
    </div>
    <div>
      <button class="btn btn-square btn-ghost btn-sm print:hidden" (click)="swapImages()">
        <ng-icon name="remixArrowLeftRightFill"></ng-icon>
      </button>
    </div>
    <div class="flex flex-1 gap-2">
      <button class="btn btn-ghost btn-sm flex-1 justify-start" (click)="openFile('modified')">
        <ng-icon name="remixImageFill"></ng-icon>
        <span>{{ modifiedFile()?.name }}</span>
      </button>
      <button class="btn btn-ghost btn-primary btn-sm" (click)="openFile('modified')">
        <ng-icon name="remixFileAddLine"></ng-icon>
        Open file
      </button>
    </div>
  </div>

  <div class="flex gap-2">
    <div role="tablist" class="tabs-boxed tabs flex-1">
      @for (option of modes; track $index) {
        <button
          role="tab"
          class="tab flex gap-2 font-bold hover:bg-base-100"
          [class.tab-active]="option === mode"
          (click)="setMode(option)"
        >
          <ng-icon [svg]="modeIcons[option]" size="1rem"></ng-icon>
          {{ option | titlecase }}
        </button>
      }
    </div>

    <div class="tabs-boxed tabs flex items-center gap-1">
      <button
        role="button"
        class="btn btn-square btn-ghost btn-sm"
        (click)="zoomLevel = zoomLevel / 2"
      >
        <ng-icon name="remixZoomOutFill"></ng-icon>
      </button>
      <span>{{ zoomLevel * 100 | number: '1.0-0' }}%</span>
      <button
        role="button"
        class="btn btn-square btn-ghost btn-sm"
        (click)="zoomLevel = zoomLevel * 2"
      >
        <ng-icon name="remixZoomInFill"></ng-icon>
      </button>
    </div>

    <div class="tabs-boxed tabs flex items-center gap-0.5">
      <button class="btn btn-ghost btn-sm" (click)="reset()">
        <ng-icon name="remixLoopRightLine"></ng-icon>
        Reset
      </button>
    </div>

    <div class="tabs-boxed tabs flex items-center gap-0.5" *ngIf="highlightDiffImage()">
      <button class="btn btn-ghost btn-sm" (click)="saveHighlightDiff()">
        <ng-icon name="remixDownload2Line"></ng-icon>
        Download
      </button>
    </div>
  </div>
  <div class="size-full justify-center rounded-lg bg-base-200 p-1">
    @switch (mode) {
      @case ('split') {
        <app-split-image-canvas
          [image1]="originalImage()!"
          [image2]="modifiedImage()!"
          [(zoom)]="zoomLevel"
        >
        </app-split-image-canvas>
      }
      @case ('fade') {
        <app-overlay-image-canvas
          [baseImage]="originalImage()!"
          [overlayImage]="modifiedImage()!"
          [(zoom)]="zoomLevel"
        ></app-overlay-image-canvas>
      }
      @case ('slider') {
        <app-slider-image-canvas
          [baseImage]="originalImage()!"
          [overlayImage]="modifiedImage()!"
          [(zoom)]="zoomLevel"
        ></app-slider-image-canvas>
      }
      @case ('difference') {
        <app-image-pixel-difference
          [baseImage]="originalImage()!"
          [overlayImage]="modifiedImage()!"
          [(zoom)]="zoomLevel"
        ></app-image-pixel-difference>
      }
      @case ('highlight') {
        <app-image-highlight-difference
          [baseImage]="originalImage()!"
          [overlayImage]="modifiedImage()!"
          (diffChange)="highlightDiffImage.set($event)"
          [(zoom)]="zoomLevel"
        ></app-image-highlight-difference>
      }
      @case ('details') {
        <div class="flex gap-12">
          <app-image-details
            class="block flex-1"
            [image]="originalImage()!"
            [file]="originalFile()!"
          ></app-image-details>
          <app-image-details
            class="block flex-1"
            [image]="modifiedImage()!"
            [file]="modifiedFile()!"
          ></app-image-details>
        </div>
      }
    }
  </div>
</div>
